<template>
   <div>
      <h6>Chat Room</h6>
      <ul>
         <li v-for="(message, index) in messages" :key="index">{{ message }}</li>
      </ul>
      <form @submit.prevent="handleSubmit">
         <input v-model="message" type="text" class="form-control" name="messageContent" placeholder="Type your message" />
         <button class="btn" type="submit">Send</button>
      </form>
   </div>

   <!-- <router-link to="/ServerChatRoom" class="nav-link text-secondary"><span class="txt-hover">客服回覆</span></router-link> -->
</template>

<script>
import { ref, onUnmounted } from "vue";
export default {
   name: "ChatRoom",
   setup() {
      const message = ref("");
      const messages = ref([]);
      const ws = new WebSocket("wss://localhost:7243/ws");

      function handleSubmit() {
         const data = {
            // userName: Math.random().toString(36).substring(7),
            message: message.value,
         };
         ws.send(JSON.stringify(data));
         message.value = "";
         console.log(message.value);
      }

      ws.onopen = () => {
         console.log("WebSocket已連接");
      };

      ws.onmessage = (event) => {
         const data = JSON.parse(event.data);
         messages.value.push(`${data.userName}: ${data.message}`);
      };

      ws.onclose = () => {
         console.log("WebSocket已關閉");
      };

      ws.onerror = (error) => {
         console.log(`WebSocket錯誤: ${error}`);
      };

      onUnmounted(() => {
         ws.close();
         console.log("聊天室已關閉");
      });

      return {
         message,
         messages,
         handleSubmit,
      };
   },
};
</script>
<style scoped>
/* 按鈕 */
.btn:not(.nav-btns button) {
   background-color: #fff;
   color: rgb(12, 13, 12);
   padding: 6px 15px;
   margin: 5px;
   border-radius: 25px;
   border: 1px solid rgb(12, 13, 12);
}
.btn:not(.nav-btns button):hover {
   background-color: #46a3ff;
   color: #fff;
   border-color: #46a3ff;
}
</style>
